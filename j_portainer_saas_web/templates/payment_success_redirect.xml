<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="payment_success_redirect" name="Payment Success Redirect">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-8 col-md-10">

                            <!-- Success Message -->
                            <div class="text-center mt-5 mb-4">
                                <div class="saas_success_icon mb-4">
                                    <i class="fa fa-check-circle" style="font-size: 4rem; color: #28a745;"></i>
                                </div>

                                <h2 class="text-success mb-3">
                                    <t t-if="is_paid_package">ðŸŽ‰ Payment Successful!</t>
                                    <t t-else="">ðŸŽ‰ Free Trial Activated!</t>
                                </h2>
                                <h4 class="text-muted">Your SaaS instance is ready and you'll be redirected in seconds...</h4>
                            </div>

                            <!-- Client Information -->
                            <div class="card mb-4">
                                <div class="card-body text-center">
                                    <h5 class="card-title">Instance Details</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <strong>Package:</strong> <span t-esc="client.sc_package_id.pkg_name"/>
                                        </div>
                                        <div class="col-md-6">
                                            <strong>Client ID:</strong> <span t-esc="client.sc_sequence"/>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-12">
                                            <strong>Instance URL:</strong> 
                                            <a t-att-href="client_domain" target="_blank" class="text-primary">
                                                <span t-esc="client_domain"/>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Progress and Redirect Info -->
                            <div class="text-center">
                                <div class="alert alert-info">
                                    <i class="fa fa-rocket"></i>
                                    <strong>Please wait...</strong> 
                                    <t t-if="deployment_initiated">Your SaaS instance is being deployed and</t>
                                    <t t-else="">Your SaaS instance is ready and</t>
                                    you'll be redirected in 
                                    <span id="countdown" t-esc="redirect_delay">5</span> seconds.
                                    <div class="saas_loading_dots mt-3">
                                        <div class="dot"></div>
                                        <div class="dot"></div>
                                        <div class="dot"></div>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-muted">
                                            <t t-if="deployment_initiated">Deployment is in progress... Please wait.</t>
                                            <t t-elif="is_paid_package">Your paid instance is ready to use!</t>
                                            <t t-else="">Your free trial instance is ready to explore!</t>
                                        </small>
                                    </div>
                                </div>

                                <div class="mt-3">
                                    <a t-att-href="client_domain" class="btn btn-primary btn-lg" target="_blank">
                                        <i class="fa fa-external-link"></i>
                                        <t t-if="is_paid_package">Go to My Instance Now</t>
                                        <t t-else="">Start Using My Free Trial</t>
                                    </a>
                                </div>

                                <div class="mt-2">
                                    <a href="/my/home" class="btn btn-secondary">
                                        <i class="fa fa-home"></i>
                                        Go to My Dashboard
                                    </a>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <!-- Auto-redirect Script -->
            <script type="text/javascript">
                <![CDATA[
                document.addEventListener('DOMContentLoaded', function() {
                    var useDeploymentMonitoring = ]]><t t-esc="use_deployment_monitoring or False"/><![CDATA[;
                    var clientId = ]]><t t-esc="client.id"/><![CDATA[;
                    var clientDomain = ']]><t t-esc="client_domain"/><![CDATA[';
                    var packageName = ']]><t t-esc="package_name"/><![CDATA[';
                    var isFreeTrialParam = ]]><t t-esc="client.sc_is_free_trial or False"/><![CDATA[;
                    
                    if (useDeploymentMonitoring) {
                        // Import deployment monitoring functions from purchase_confirm.js
                        var script = document.createElement('script');
                        script.src = '/j_portainer_saas_web/static/src/js/purchase_confirm.js';
                        script.onload = function() {
                            // Show deployment monitoring overlay after short delay
                            setTimeout(function() {
                                if (typeof showDeploymentMonitoring === 'function') {
                                    showDeploymentMonitoring(clientId, clientDomain, packageName, isFreeTrialParam);
                                }
                            }, 1000);
                        };
                        document.head.appendChild(script);
                    } else {
                        // Legacy countdown redirect
                        var countdown = parseInt(document.getElementById('countdown').textContent);
                        var timer = setInterval(function() {
                            countdown--;
                            document.getElementById('countdown').textContent = countdown;

                            if (countdown <= 0) {
                                clearInterval(timer);
                                window.location.href = clientDomain;
                            }
                        }, 1000);
                    }
                });
                ]]>
            </script>
        </t>
    </template>
</odoo>
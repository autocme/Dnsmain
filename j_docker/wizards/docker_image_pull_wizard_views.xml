<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Docker Image Pull Wizard Form View -->
    <record id="view_docker_image_pull_wizard_form" model="ir.ui.view">
        <field name="name">j_docker.image.pull.wizard.form</field>
        <field name="model">j_docker.image.pull.wizard</field>
        <field name="arch" type="xml">
            <form string="Pull Docker Image">
                <sheet>
                    <div invisible="state != 'name'" class="oe_title">
                        <h1>Pull Image from Docker Hub</h1>
                        <field name="state" invisible="1"/>
                        <group>
                            <field name="server_id" options="{'no_create': True}" readonly="context.get('readonly_server')"/>
                            <field name="image_name" placeholder="e.g., nginx, ubuntu, postgres"/>
                            <field name="tag" placeholder="e.g., latest, alpine, 1.21.1"/>
                            <field name="full_name" readonly="1"/>
                        </group>
                    </div>
                    
                    <div invisible="state != 'pulling'" class="oe_title">
                        <h1>Pulling Image...</h1>
                        <field name="state" invisible="1"/>
                        <div class="text-center">
                            <span class="fa fa-spinner fa-spin fa-3x"/>
                            <p class="text-muted">This may take some time depending on image size and your connection.</p>
                        </div>
                    </div>
                    
                    <div invisible="state != 'done'" class="oe_title">
                        <h1>Image Pull Complete</h1>
                        <field name="state" invisible="1"/>
                        <group>
                            <field name="full_name" readonly="1"/>
                            <field name="pull_progress" readonly="1" widget="text_code"/>
                        </group>
                    </div>
                </sheet>
                
                <footer>
                    <button name="pull_image" string="Pull Image" type="object" class="btn-primary" 
                            invisible="state != 'name'"/>
                    <button name="action_back_to_name" string="Back" type="object" 
                            invisible="state != 'done'"/>
                    <button name="action_close" string="Close" type="object" class="btn-secondary" 
                            invisible="state != 'done'"/>
                    <button string="Cancel" class="btn-secondary" special="cancel" invisible="state == 'pulling'"/>
                </footer>
            </form>
        </field>
    </record>
    
    <!-- Docker Image Pull Wizard Action -->
    <record id="action_docker_image_pull_wizard" model="ir.actions.act_window">
        <field name="name">Pull Image from Docker Hub</field>
        <field name="res_model">j_docker.image.pull.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>
    
    <!-- Action from docker_images tree view -->
    <record id="action_pull_image_from_hub" model="ir.actions.act_window">
        <field name="name">Pull from Docker Hub</field>
        <field name="res_model">j_docker.image.pull.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{'readonly_server': True}</field>
    </record>
    
    <!-- Add button to Docker Images form -->
    <record id="view_docker_images_button" model="ir.ui.view">
        <field name="name">j_docker.docker_images.pull.button</field>
        <field name="model">j_docker.docker_server</field>
        <field name="inherit_id" ref="view_docker_server_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='image_ids']/tree" position="attributes">
                <attribute name="decoration-danger">repository == False or repository == ''</attribute>
            </xpath>
            <xpath expr="//field[@name='image_ids']" position="before">
                <button name="%(action_docker_image_pull_wizard)d" string="Pull From Docker Hub" type="action" 
                        context="{'default_server_id': active_id}" class="btn-primary"/>
            </xpath>
        </field>
    </record>
    
    <!-- Add menu item under Docker Configuration -->
    <menuitem id="menu_docker_pull_image"
              name="Pull New Image"
              parent="menu_docker_images"
              action="action_docker_image_pull_wizard"
              sequence="10"/>
</odoo>